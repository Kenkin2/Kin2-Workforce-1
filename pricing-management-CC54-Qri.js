import{r as v,u as Q,o as V,i as M,l as z,j as e,aF as m,J as G,K as J,N,O as f,C as n,e as l,f as r,a as c,m as y,Q as t,b as d,I as S,d as F,S as H,n as A}from"./index-aBzEQGYq.js";import{S as W,a as X,b as Y,c as Z,d as _}from"./select-L0woBkk0.js";import{D as ee}from"./dollar-sign-BYstf_kA.js";import{T as D}from"./trending-up-EJ-1Wo56.js";import{U as se}from"./users-DQHjr_4E.js";import{C as ae}from"./credit-card-CxGwdsfA.js";import{C as te}from"./calculator-Ch1wpyY6.js";import"./index-oqkmxxPa.js";import"./Combination-D-0K7YMg.js";function ue(){var B;const[b,R]=v.useState(""),[p,O]=v.useState(10),[x,E]=v.useState(""),[o,$]=v.useState(null),{toast:u}=Q(),k=V(),{data:T=[],isLoading:L}=M({queryKey:["/api/pricing/plans"]}),{data:a,isLoading:j}=M({queryKey:["/api/pricing/metrics"]}),P=z({mutationFn:async s=>(await A("POST","/api/pricing/calculate",s)).json(),onSuccess:s=>{$(s),u({title:"Pricing Calculated",description:`Final price: £${s.finalPrice} per employee per month`})},onError:()=>{u({title:"Calculation Failed",description:"Could not calculate pricing. Please try again.",variant:"destructive"})}}),C=z({mutationFn:async s=>(await A("POST",`/api/pricing/billing/process/${s}`,{})).json(),onSuccess:()=>{u({title:"Billing Processed",description:"Billing cycle has been processed successfully."}),k.invalidateQueries({queryKey:["/api/pricing/metrics"]})},onError:()=>{u({title:"Billing Failed",description:"Could not process billing. Please try again.",variant:"destructive"})}}),U=()=>{if(!b||!p){u({title:"Missing Information",description:"Please select a plan and enter employee count.",variant:"destructive"});return}P.mutate({planId:b,employeeCount:p,organizationId:x||void 0})},q=()=>{if(!x){u({title:"Missing Organization",description:"Please enter an organization ID.",variant:"destructive"});return}C.mutate(x)},i=s=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(s),I=s=>`${s.toFixed(1)}%`;return L?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(m,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-8","data-testid":"pricing-management-page",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight","data-testid":"page-title",children:"Pricing Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pricing plans, billing automation, and revenue analytics"})]})]}),e.jsxs(G,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(J,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"overview",children:"Overview"}),e.jsx(N,{value:"calculator",children:"Pricing Calculator"}),e.jsx(N,{value:"plans",children:"Plans"}),e.jsx(N,{value:"billing",children:"Billing"})]}),e.jsxs(f,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(n,{"data-testid":"revenue-card",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"total-revenue",children:j?e.jsx(m,{className:"h-6 w-6 animate-spin"}):i((a==null?void 0:a.totalRevenue)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time revenue"})]})]}),e.jsxs(n,{"data-testid":"subscriptions-card",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Active Subscriptions"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"active-subscriptions",children:j?e.jsx(m,{className:"h-6 w-6 animate-spin"}):(a==null?void 0:a.activeSubscriptions)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently paying"})]})]}),e.jsxs(n,{"data-testid":"mrr-card",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Monthly Recurring Revenue"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"mrr-amount",children:j?e.jsx(m,{className:"h-6 w-6 animate-spin"}):i((a==null?void 0:a.monthlyRecurringRevenue)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"MRR this month"})]})]}),e.jsxs(n,{"data-testid":"churn-card",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Churn Rate"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"churn-rate",children:j?e.jsx(m,{className:"h-6 w-6 animate-spin"}):I((a==null?void 0:a.churnRate)||0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Monthly churn"})]})]})]}),e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsx(r,{children:"Revenue Analytics"}),e.jsx(y,{children:"Key performance indicators for your pricing strategy"})]}),e.jsx(c,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{className:"text-sm text-muted-foreground",children:"Average Employee Count"}),e.jsx("div",{className:"text-xl font-semibold","data-testid":"avg-employee-count",children:((B=a==null?void 0:a.averageEmployeeCount)==null?void 0:B.toFixed(1))||"0.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{className:"text-sm text-muted-foreground",children:"Revenue per Employee"}),e.jsx("div",{className:"text-xl font-semibold","data-testid":"revenue-per-employee",children:a!=null&&a.averageEmployeeCount&&a.totalRevenue?i(a.totalRevenue/a.averageEmployeeCount):i(0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{className:"text-sm text-muted-foreground",children:"Market Position"}),e.jsx(d,{variant:"secondary","data-testid":"market-position",children:"Enterprise Tier (£20-35 PEPM)"})]})]})})]})]}),e.jsx(f,{value:"calculator",className:"space-y-6",children:e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Dynamic Pricing Calculator"]}),e.jsx(y,{children:"Calculate custom pricing based on employee count and pricing rules"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"plan-select",children:"Pricing Plan"}),e.jsxs(W,{value:b,onValueChange:R,children:[e.jsx(X,{"data-testid":"plan-selector",children:e.jsx(Y,{placeholder:"Select a plan"})}),e.jsx(Z,{children:T.map(s=>e.jsxs(_,{value:s.id,children:[s.name," - ",i(parseFloat(s.basePrice))," per employee"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"employee-count",children:"Employee Count"}),e.jsx(S,{id:"employee-count",type:"number",min:"1",max:"10000",value:p,onChange:s=>O(parseInt(s.target.value)||1),"data-testid":"input-employee-count"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"organization-id",children:"Organization ID (Optional)"}),e.jsx(S,{id:"organization-id",placeholder:"Enter organization ID for existing rules",value:x,onChange:s=>E(s.target.value),"data-testid":"input-organization-id"})]})]}),e.jsxs(F,{onClick:U,disabled:P.isPending,className:"w-full md:w-auto","data-testid":"button-calculate-pricing",children:[P.isPending&&e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),"Calculate Pricing"]}),o&&e.jsxs(n,{className:"border-green-200 bg-green-50",children:[e.jsx(l,{children:e.jsx(r,{className:"text-green-800",children:"Pricing Calculation Results"})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{className:"text-sm text-green-600",children:"Base Price"}),e.jsx("div",{className:"text-xl font-bold text-green-800","data-testid":"calculated-base-price",children:i(o.basePrice)}),e.jsx("p",{className:"text-xs text-green-600",children:"per employee per month"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{className:"text-sm text-green-600",children:"Total Discount"}),e.jsx("div",{className:"text-xl font-bold text-green-800","data-testid":"calculated-discount",children:I(o.discount)}),e.jsx("p",{className:"text-xs text-green-600",children:"off base price"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(t,{className:"text-sm text-green-600",children:"Final Price"}),e.jsx("div",{className:"text-xl font-bold text-green-800","data-testid":"calculated-final-price",children:i(o.finalPrice)}),e.jsx("p",{className:"text-xs text-green-600",children:"per employee per month"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{className:"text-sm text-green-600",children:"Monthly Total"}),e.jsx("div",{className:"text-2xl font-bold text-green-800","data-testid":"calculated-monthly-total",children:i(o.finalPrice*p)})]}),o.appliedRules.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{className:"text-sm text-green-600",children:"Applied Pricing Rules"}),e.jsx("div",{className:"space-y-1",children:o.appliedRules.map((s,h)=>e.jsx(d,{variant:"outline",className:"text-green-700 border-green-300",children:s},h))})]})]})]})]})]})}),e.jsx(f,{value:"plans",className:"space-y-6",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:T.map(s=>{const h=JSON.parse(s.features)||[],w=h.filter(g=>g.included);return h.filter(g=>!g.included),e.jsxs(n,{className:"relative",children:[e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{"data-testid":`plan-title-${s.id}`,children:s.name}),s.discountPercent!=="0"&&e.jsxs(d,{variant:"secondary","data-testid":`plan-discount-${s.id}`,children:[s.discountPercent,"% OFF"]})]}),e.jsx(y,{"data-testid":`plan-description-${s.id}`,children:s.description})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-3xl font-bold","data-testid":`plan-price-${s.id}`,children:i(parseFloat(s.basePrice))}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"per employee per month"})]}),s.setupFee!=="0"&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Setup fee: ",i(parseFloat(s.setupFee))]}),s.maxEmployees&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Up to ",s.maxEmployees," employees"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-green-600",children:"Included Features"}),e.jsxs("div",{className:"space-y-1",children:[w.slice(0,5).map((g,K)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{children:g.name})]},K)),w.length>5&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["+ ",w.length-5," more features"]})]})]}),e.jsx(F,{variant:"outline",className:"w-full",onClick:()=>R(s.id),"data-testid":`button-select-plan-${s.id}`,children:"Select Plan"})]})]},s.id)})})}),e.jsx(f,{value:"billing",className:"space-y-6",children:e.jsxs(n,{children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Billing Management"]}),e.jsx(y,{children:"Process billing cycles and manage organization subscriptions"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"billing-org-id",children:"Organization ID"}),e.jsx(S,{id:"billing-org-id",placeholder:"Enter organization ID to process billing",value:x,onChange:s=>E(s.target.value),"data-testid":"input-billing-org-id"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(F,{onClick:q,disabled:C.isPending||!x,"data-testid":"button-process-billing",children:[C.isPending&&e.jsx(m,{className:"mr-2 h-4 w-4 animate-spin"}),"Process Billing"]})})]})}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Automated Billing Status"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-800",children:"Billing Automation"}),e.jsx("div",{className:"text-sm text-green-600",children:"Running continuously"})]}),e.jsx(d,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Active"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-800",children:"Usage Tracking"}),e.jsx("div",{className:"text-sm text-blue-600",children:"Real-time monitoring"})]}),e.jsx(d,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Active"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Pricing Strategy"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm",children:"Volume Discounts"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"50-99 employees"}),e.jsx(d,{variant:"outline",children:"5% discount"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"100-249 employees"}),e.jsx(d,{variant:"outline",children:"10% discount"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"250+ employees"}),e.jsx(d,{variant:"outline",children:"20% discount"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm",children:"Automated Features"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{children:"Usage-based billing adjustments"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{children:"Prorated billing for mid-cycle changes"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{children:"Automatic trial-to-paid conversion"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{children:"Failed payment handling"})]})]})]})]})]})]})]})})]})]})}export{ue as default};
