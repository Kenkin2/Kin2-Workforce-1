import{u as fe,g as Ne,r as w,i as le,l as re,j as e,d as T,J as ge,K as be,N as P,O as R,C as n,e as l,f as r,a as o,Q as D,I,V as ve,b as oe,q as ce,n as C}from"./index-aBzEQGYq.js";import{A as we}from"./app-layout-DNSppN_P.js";import{S as Pe,a as Re,b as De,c as Ce,d as k}from"./select-L0woBkk0.js";import{t as xe,f as u}from"./format-CYGoIBvn.js";import{C as me}from"./calculator-Ch1wpyY6.js";import{U as Fe}from"./users-DQHjr_4E.js";import{T as Me}from"./trending-up-EJ-1Wo56.js";import{C as Te}from"./clock-Dcf5yqqC.js";import{F as H}from"./file-text-DGolt20j.js";import"./avatar-B73pXDWb.js";import"./target-kE2L6cy0.js";import"./calendar-B5qd1N74.js";import"./building-DW2XR0jT.js";import"./handshake-DxRR1pa7.js";import"./credit-card-CxGwdsfA.js";import"./crown-J1RsCPzy.js";import"./map-pin-D49hIz5W.js";import"./pound-sterling-DvDjXgI4.js";import"./message-square-CV5BlX6z.js";import"./shield-check-DrJu6eCf.js";import"./Combination-D-0K7YMg.js";import"./index-oqkmxxPa.js";import"./scroll-area-Dsz05QRK.js";import"./alert-dialog-CGu9Do5w.js";import"./index-r-q9YERm.js";import"./dialog-23jdk0P0.js";import"./send-DOYPj-_D.js";function Ie(c){const i=xe(c),h=i.getMonth();return i.setFullYear(i.getFullYear(),h+1,0),i.setHours(23,59,59,999),i}function ke(c){const i=xe(c);return i.setDate(1),i.setHours(0,0,0,0),i}function rs(){var A,W,E,L,q,V,U,Y,O,S,_,K,Q,B,z,J,X,Z,ee,se,ae;const{toast:c}=fe(),{isAuthenticated:i,isLoading:h}=Ne(),[b,ue]=w.useState("2024-25"),[$,he]=w.useState(u(new Date,"yyyy-MM")),[x,G]=w.useState({startDate:u(ke(new Date),"yyyy-MM-dd"),endDate:u(Ie(new Date),"yyyy-MM-dd")}),{data:a,isLoading:He}=le({queryKey:["/api/reports/payroll-summary",x.startDate,x.endDate],queryFn:()=>C("GET",`/api/reports/payroll-summary?startDate=${x.startDate}&endDate=${x.endDate}`).then(s=>s.json()),enabled:i}),{data:v,isLoading:$e}=le({queryKey:["/api/payroll/records",b],queryFn:()=>C("GET",`/api/payroll/records?year=${b}`).then(s=>s.json()),enabled:i}),F=re({mutationFn:async s=>C("POST","/api/payroll/generate",s).then(t=>t.json()),onSuccess:s=>{c({title:"Payroll Generated",description:`Successfully generated ${s.recordsGenerated} payroll records`}),ce.invalidateQueries({queryKey:["/api/payroll/records"]}),ce.invalidateQueries({queryKey:["/api/reports/payroll-summary"]})},onError:s=>{c({title:"Generation Failed",description:s.message||"Failed to generate payroll",variant:"destructive"})}}),M=re({mutationFn:async s=>({blob:await(await C("POST","/api/reports/hmrc-csv",s)).blob(),filename:`HMRC_FPS_${s.taxYear}_${s.payPeriod}.csv`}),onSuccess:({blob:s,filename:t})=>{const m=window.URL.createObjectURL(s),d=document.createElement("a");d.href=m,d.download=t,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(m),c({title:"CSV Downloaded",description:"HMRC submission file downloaded successfully"})},onError:s=>{c({title:"Download Failed",description:s.message||"Failed to download HMRC CSV",variant:"destructive"})}}),pe=()=>{F.mutate(x)},je=()=>{M.mutate({taxYear:b,payPeriod:$})},ye=(s,t)=>{window.open(`/api/payslips/${s}/${t}`,"_blank")};return w.useEffect(()=>{if(!h&&!i){c({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}},[i,h,c]),h||!i?e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsx(we,{title:"Advanced Reports",breadcrumbs:[{label:"Analytics",href:"/analytics"},{label:"Reports"}],children:e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-foreground to-primary bg-clip-text text-transparent",children:"Advanced Reports"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Generate payroll reports, HMRC submissions, and payslips"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(T,{onClick:pe,disabled:F.isPending,className:"shadow-lg","data-testid":"button-generate-payroll",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),F.isPending?"Generating...":"Generate Payroll"]})})]}),e.jsxs(ge,{defaultValue:"summary",className:"space-y-6",children:[e.jsxs(be,{className:"grid w-full grid-cols-4",children:[e.jsx(P,{value:"summary","data-testid":"tab-summary",children:"Summary"}),e.jsx(P,{value:"hmrc","data-testid":"tab-hmrc",children:"HMRC Reports"}),e.jsx(P,{value:"payslips","data-testid":"tab-payslips",children:"Payslips"}),e.jsx(P,{value:"analytics","data-testid":"tab-analytics",children:"Analytics"})]}),e.jsxs(R,{value:"summary",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(n,{className:"hover:shadow-lg transition-all duration-300 animate-slideIn",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Workers"}),e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:((A=a==null?void 0:a.summary)==null?void 0:A.totalWorkers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active this period"})]})]}),e.jsxs(n,{className:"hover:shadow-lg transition-all duration-300 animate-slideIn [animation-delay:100ms]",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Gross Pay"}),e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["£",((E=(W=a==null?void 0:a.summary)==null?void 0:W.totalGrossPay)==null?void 0:E.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Before deductions"})]})]}),e.jsxs(n,{className:"hover:shadow-lg transition-all duration-300 animate-slideIn [animation-delay:200ms]",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Net Pay"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["£",((q=(L=a==null?void 0:a.summary)==null?void 0:L.totalNetPay)==null?void 0:q.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"After deductions"})]})]}),e.jsxs(n,{className:"hover:shadow-lg transition-all duration-300 animate-slideIn [animation-delay:300ms]",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Hours Worked"}),e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:((U=(V=a==null?void 0:a.summary)==null?void 0:V.totalHoursWorked)==null?void 0:U.toFixed(0))||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total hours"})]})]})]}),e.jsxs(n,{className:"animate-slideIn [animation-delay:400ms]",children:[e.jsx(l,{children:e.jsx(r,{children:"Period Settings"})}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"start-date",children:"Start Date"}),e.jsx(I,{id:"start-date",type:"date",value:x.startDate,onChange:s=>G(t=>({...t,startDate:s.target.value})),"data-testid":"input-start-date"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"end-date",children:"End Date"}),e.jsx(I,{id:"end-date",type:"date",value:x.endDate,onChange:s=>G(t=>({...t,endDate:s.target.value})),"data-testid":"input-end-date"})]})]})})]}),(a==null?void 0:a.workers)&&e.jsxs(n,{className:"animate-slideIn [animation-delay:500ms]",children:[e.jsx(l,{children:e.jsx(r,{children:"Worker Payroll Summary"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:a.workers.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors animate-slideIn",style:{animationDelay:`${600+t*100}ms`},"data-testid":`row-worker-${s.workerId}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.workerName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.hoursWorked.toFixed(1)," hours • £",(s.grossPay/s.hoursWorked).toFixed(2),"/hr"]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"font-bold text-green-600",children:["£",s.netPay.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Gross: £",s.grossPay.toFixed(2)]})]})]},s.workerId))})})]})]}),e.jsxs(R,{value:"hmrc",className:"space-y-6",children:[e.jsxs(n,{className:"animate-slideIn",children:[e.jsx(l,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"HMRC Submissions"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"tax-year",children:"Tax Year"}),e.jsxs(Pe,{value:b,onValueChange:ue,children:[e.jsx(Re,{"data-testid":"select-tax-year",children:e.jsx(De,{placeholder:"Select tax year"})}),e.jsxs(Ce,{children:[e.jsx(k,{value:"2024-25",children:"2024-25"}),e.jsx(k,{value:"2023-24",children:"2023-24"}),e.jsx(k,{value:"2022-23",children:"2022-23"})]})]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"pay-period",children:"Pay Period"}),e.jsx(I,{id:"pay-period",type:"month",value:$,onChange:s=>he(s.target.value),"data-testid":"input-pay-period"})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(T,{onClick:je,disabled:M.isPending,className:"shadow-lg","data-testid":"button-download-hmrc",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),M.isPending?"Generating...":"Download FPS CSV"]})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-l-4 border-blue-500",children:[e.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"HMRC Submission Information"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• FPS (Full Payment Submission) reports must be submitted to HMRC on or before pay date"}),e.jsx("li",{children:"• CSV format is compatible with HMRC RTI (Real Time Information) system"}),e.jsx("li",{children:"• Includes tax, National Insurance, and pension contribution data"}),e.jsx("li",{children:"• Automatically calculates year-to-date figures for compliance"})]})]})]})]}),v&&e.jsxs(n,{className:"animate-slideIn [animation-delay:200ms]",children:[e.jsx(l,{children:e.jsx(r,{children:"Recent Submissions"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:v.slice(0,5).map((s,t)=>{var m,d,p,j,y,f,N,g;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg animate-slideIn",style:{animationDelay:`${300+t*100}ms`},"data-testid":`row-submission-${((m=s.payrollRecord)==null?void 0:m.id)||s.id}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[(d=s.worker)==null?void 0:d.firstName," ",(p=s.worker)==null?void 0:p.lastName]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(j=s.payrollRecord)!=null&&j.payPeriodStart?u(new Date(s.payrollRecord.payPeriodStart),"MMM yyyy"):"N/A"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold",children:["£",parseFloat(((y=s.payrollRecord)==null?void 0:y.netPay)||s.netPay||"0").toFixed(2)]}),e.jsx(oe,{variant:(f=s.payrollRecord)!=null&&f.hmrcReported?"default":"secondary",children:(N=s.payrollRecord)!=null&&N.hmrcReported?"Reported":"Pending"})]})]},((g=s.payrollRecord)==null?void 0:g.id)||s.id)})})})]})]}),e.jsx(R,{value:"payslips",className:"space-y-6",children:e.jsxs(n,{className:"animate-slideIn",children:[e.jsx(l,{children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Payslip Management"]})}),e.jsx(o,{children:v&&e.jsx("div",{className:"space-y-3",children:v.map((s,t)=>{var m,d,p,j,y,f,N,g,te,ie;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors animate-slideIn",style:{animationDelay:`${100+t*50}ms`},"data-testid":`row-payslip-${((m=s.payrollRecord)==null?void 0:m.id)||s.id}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[(d=s.worker)==null?void 0:d.firstName," ",(p=s.worker)==null?void 0:p.lastName]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(j=s.payrollRecord)!=null&&j.payPeriodStart&&((y=s.payrollRecord)!=null&&y.payPeriodEnd)?`${u(new Date(s.payrollRecord.payPeriodStart),"dd MMM")} - ${u(new Date(s.payrollRecord.payPeriodEnd),"dd MMM yyyy")}`:"N/A"})]}),e.jsxs("div",{className:"text-right mr-4",children:[e.jsxs("div",{className:"font-bold text-green-600",children:["£",parseFloat(((f=s.payrollRecord)==null?void 0:f.netPay)||s.netPay||"0").toFixed(2)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Net Pay"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(oe,{variant:(N=s.payrollRecord)!=null&&N.payslipGenerated?"default":"secondary",children:(g=s.payrollRecord)!=null&&g.payslipGenerated?"Generated":"Pending"}),e.jsxs(T,{size:"sm",variant:"outline",onClick:()=>{var de,ne;return ye(((de=s.worker)==null?void 0:de.id)||s.workerId,((ne=s.payrollRecord)==null?void 0:ne.id)||s.id)},"data-testid":`button-view-payslip-${((te=s.payrollRecord)==null?void 0:te.id)||s.id}`,children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"View"]})]})]},((ie=s.payrollRecord)==null?void 0:ie.id)||s.id)})})})]})}),e.jsx(R,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(n,{className:"animate-slideIn",children:[e.jsx(l,{children:e.jsx(r,{children:"Tax Summary"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Tax Deducted"}),e.jsxs("span",{className:"font-bold",children:["£",((O=(Y=a==null?void 0:a.summary)==null?void 0:Y.totalTaxDeducted)==null?void 0:O.toFixed(2))||"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total NI Deducted"}),e.jsxs("span",{className:"font-bold",children:["£",((_=(S=a==null?void 0:a.summary)==null?void 0:S.totalNIDeducted)==null?void 0:_.toFixed(2))||"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Pension Contributions"}),e.jsxs("span",{className:"font-bold",children:["£",((Q=(K=a==null?void 0:a.summary)==null?void 0:K.totalPensionDeducted)==null?void 0:Q.toFixed(2))||"0.00"]})]}),e.jsxs("div",{className:"border-t pt-3 flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Deductions"}),e.jsxs("span",{className:"font-bold text-red-600",children:["£",((((B=a==null?void 0:a.summary)==null?void 0:B.totalTaxDeducted)||0)+(((z=a==null?void 0:a.summary)==null?void 0:z.totalNIDeducted)||0)+(((J=a==null?void 0:a.summary)==null?void 0:J.totalPensionDeducted)||0)).toFixed(2)]})]})]})})]}),e.jsxs(n,{className:"animate-slideIn [animation-delay:200ms]",children:[e.jsx(l,{children:e.jsx(r,{children:"Workforce Metrics"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Average Hourly Rate"}),e.jsxs("span",{className:"font-bold",children:["£",((Z=(X=a==null?void 0:a.summary)==null?void 0:X.averageHourlyRate)==null?void 0:Z.toFixed(2))||"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Hours"}),e.jsx("span",{className:"font-bold",children:((se=(ee=a==null?void 0:a.summary)==null?void 0:ee.totalHoursWorked)==null?void 0:se.toFixed(0))||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Avg Hours per Worker"}),e.jsx("span",{className:"font-bold",children:(ae=a==null?void 0:a.summary)!=null&&ae.totalWorkers?(a.summary.totalHoursWorked/a.summary.totalWorkers).toFixed(1):0})]}),e.jsxs("div",{className:"border-t pt-3 flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Period"}),e.jsxs("span",{className:"font-bold",children:[a==null?void 0:a.periodStart," - ",a==null?void 0:a.periodEnd]})]})]})})]})]})})]})]})})}export{rs as default};
