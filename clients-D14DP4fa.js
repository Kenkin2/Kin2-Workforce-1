import{u as E,g as L,r as y,i as $,l as q,j as e,d as t,Y as c,I as n,C as m,a as x,e as z,f as D,b as M,q as P,n as T}from"./index-aBzEQGYq.js";import{u as I}from"./useRoleAccess-BKwNGKWG.js";import{D as k,a as O,b as B,c as J,d as R}from"./dialog-23jdk0P0.js";import{A as Y}from"./app-layout-DNSppN_P.js";import{z as l,u as H,F as K,a as u,b as h,c as j,d as p,e as g,t as Q}from"./index-Bc3Dxx3z.js";import{A as U,a as V,b as _}from"./avatar-B73pXDWb.js";import{S as G}from"./search-BRbz_E2x.js";import{F as W}from"./filter-D93feKS8.js";import{E as X}from"./eye-BznRa7X0.js";import{P as Z}from"./pencil-NTBry3l3.js";import"./index-r-q9YERm.js";import"./Combination-D-0K7YMg.js";import"./target-kE2L6cy0.js";import"./calendar-B5qd1N74.js";import"./clock-Dcf5yqqC.js";import"./users-DQHjr_4E.js";import"./building-DW2XR0jT.js";import"./handshake-DxRR1pa7.js";import"./credit-card-CxGwdsfA.js";import"./calculator-Ch1wpyY6.js";import"./crown-J1RsCPzy.js";import"./map-pin-D49hIz5W.js";import"./pound-sterling-DvDjXgI4.js";import"./trending-up-EJ-1Wo56.js";import"./message-square-CV5BlX6z.js";import"./file-text-DGolt20j.js";import"./shield-check-DrJu6eCf.js";import"./index-oqkmxxPa.js";import"./scroll-area-Dsz05QRK.js";import"./alert-dialog-CGu9Do5w.js";import"./send-DOYPj-_D.js";function qe(){const{toast:i}=E(),{isAuthenticated:d,isLoading:f}=L(),{canManageClients:N}=I(),[w,o]=y.useState(!1);y.useEffect(()=>{if(!f&&!d){i({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}},[d,f,i]);const{data:b,isLoading:A}=$({queryKey:["/api/clients"],enabled:d}),F=l.object({email:l.string().email({message:"Please enter a valid email address"}).min(1,{message:"Email is required"}),firstName:l.string().min(1,{message:"First name is required"}).max(50,{message:"First name must be 50 characters or less"}),lastName:l.string().min(1,{message:"Last name is required"}).max(50,{message:"Last name must be 50 characters or less"}),organizationName:l.string().min(2,{message:"Company name must be at least 2 characters"}).max(100,{message:"Company name must be 100 characters or less"})}),a=H({resolver:Q(F),defaultValues:{email:"",firstName:"",lastName:"",organizationName:""}}),v=q({mutationFn:async s=>(await T("POST","/api/clients",{...s,role:"client"})).json(),onSuccess:()=>{i({title:"Success",description:"Client added successfully!"}),P.invalidateQueries({queryKey:["/api/clients"]}),o(!1),a.reset()},onError:()=>{i({title:"Error",description:"Failed to add client. Please try again.",variant:"destructive"})}}),S=s=>{v.mutate(s)};return f||!d?e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsx(Y,{title:"Clients",breadcrumbs:[{label:"Management",href:"/dashboard"},{label:"Clients"}],children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"Client Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage client accounts and organizations"})]}),N&&e.jsxs(k,{open:w,onOpenChange:o,children:[e.jsx(O,{asChild:!0,children:e.jsxs(t,{"data-testid":"button-add-client",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Add Client"]})}),e.jsxs(B,{className:"sm:max-w-[425px]",children:[e.jsx(J,{children:e.jsx(R,{children:"Add New Client"})}),e.jsx(K,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(S),className:"space-y-4",children:[e.jsx(u,{control:a.control,name:"organizationName",render:({field:s})=>e.jsxs(h,{children:[e.jsx(j,{children:"Company Name"}),e.jsx(p,{children:e.jsx(n,{placeholder:"Acme Corporation",...s,"data-testid":"input-client-company"})}),e.jsx(g,{})]})}),e.jsx(u,{control:a.control,name:"email",render:({field:s})=>e.jsxs(h,{children:[e.jsx(j,{children:"Contact Email"}),e.jsx(p,{children:e.jsx(n,{type:"email",placeholder:"contact@company.com",...s,"data-testid":"input-client-email"})}),e.jsx(g,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{control:a.control,name:"firstName",render:({field:s})=>e.jsxs(h,{children:[e.jsx(j,{children:"First Name"}),e.jsx(p,{children:e.jsx(n,{placeholder:"Jane",...s,"data-testid":"input-client-first-name"})}),e.jsx(g,{})]})}),e.jsx(u,{control:a.control,name:"lastName",render:({field:s})=>e.jsxs(h,{children:[e.jsx(j,{children:"Last Name"}),e.jsx(p,{children:e.jsx(n,{placeholder:"Smith",...s,"data-testid":"input-client-last-name"})}),e.jsx(g,{})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>o(!1),"data-testid":"button-cancel-client",children:"Cancel"}),e.jsxs(t,{type:"submit",disabled:v.isPending,"data-testid":"button-submit-client",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),v.isPending?"Adding...":"Add Client"]})]})]})})]})]})]}),e.jsx(m,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(n,{placeholder:"Search clients...",className:"pl-10","data-testid":"input-search-clients"}),e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"})]}),e.jsxs(t,{variant:"outline","data-testid":"button-filter-clients",onClick:()=>i({title:"Filters",description:"Client filtering coming soon!"}),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Filters"]})]})})}),A?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((s,r)=>e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full mb-4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]})})},r))}):b&&b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(s=>{var r,C;return e.jsxs(m,{className:"hover:shadow-lg transition-shadow","data-testid":`card-client-${s.id}`,children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(U,{className:"w-16 h-16",children:[e.jsx(V,{src:s.profileImageUrl||void 0,alt:`${s.firstName} ${s.lastName}`}),e.jsxs(_,{children:[(r=s.firstName)==null?void 0:r.charAt(0),(C=s.lastName)==null?void 0:C.charAt(0)]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(D,{className:"text-lg","data-testid":`text-client-name-${s.id}`,children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":`text-client-email-${s.id}`,children:s.email}),e.jsx(M,{variant:"outline",className:"mt-2","data-testid":`badge-client-role-${s.id}`,children:s.role})]})]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Joined:"}),e.jsx("span",{className:"text-foreground","data-testid":`text-client-joined-${s.id}`,children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Active Jobs:"}),e.jsx("span",{className:"text-foreground font-medium",children:"3"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Spent:"}),e.jsx("span",{className:"text-foreground font-medium",children:"Â£24,560"})]})]}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"flex-1","data-testid":`button-view-client-${s.id}`,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"View"]}),e.jsxs(t,{variant:"outline",size:"sm",className:"flex-1","data-testid":`button-edit-client-${s.id}`,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Edit"]})]})]})]},s.id)})}):e.jsx(m,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(c,{className:"w-16 h-16 text-muted-foreground mb-4 mx-auto"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:N?"Start onboarding your first client":"No clients available at this time"}),N&&e.jsxs(t,{onClick:()=>o(!0),"data-testid":"button-add-first-client",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Add Your First Client"]})]})})})]})})}export{qe as default};
