import{c as K,r as P,u as V,o as B,i as $,l as E,j as e,d as l,I as J,z as Q,J as U,K as H,N,O as b,C as i,e as c,f as o,S as Z,b as h,m as x,a as r,D as I,M as X,T as G,Z as Y,n as z}from"./index-aBzEQGYq.js";import{D as ee,a as se,b as te,c as ae,d as ie,e as re}from"./dialog-23jdk0P0.js";import{u as le,F as de,a as u,b as j,c as p,d as g,e as w,f as ne,t as ce,z as t}from"./index-Bc3Dxx3z.js";import{T as oe}from"./textarea-BY0bzfyA.js";import{S as xe,a as me,b as he,c as ue,d as m}from"./select-L0woBkk0.js";import{P as je}from"./plus-BIW1JAb4.js";import{P as pe}from"./play-B7MbPeZR.js";import{S as ge}from"./square-pen-ajYTr43k.js";import{C as ve}from"./circle-check-big-DoRqGQom.js";import{C as fe}from"./circle-x-pQhUaXCr.js";import{C as ye}from"./clock-Dcf5yqqC.js";import"./index-r-q9YERm.js";import"./Combination-D-0K7YMg.js";import"./index-oqkmxxPa.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=K("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),be=t.object({name:t.string().min(1,"Rule name is required"),description:t.string().min(1,"Description is required"),triggerType:t.enum(["job_created","shift_completed","payment_processed","user_registered","schedule_time"]),conditions:t.array(t.object({field:t.string(),operator:t.enum(["equals","not_equals","greater_than","less_than","contains","exists"]),value:t.string()})),actions:t.array(t.object({type:t.enum(["send_notification","assign_worker","update_status","create_task","send_email","webhook_call"]),config:t.record(t.any())})),isActive:t.boolean().default(!0)});function Le(){var T,S,_,A,D,R,F;const[L,v]=P.useState(!1),[we,Ce]=P.useState(null),{toast:f}=V(),C=B(),{data:M=[],isLoading:W}=$({queryKey:["/api/workflows/rules"]}),{data:n={stats:null,executions:[]}}=$({queryKey:["/api/workflows/executions"],refetchInterval:1e4}),d=le({resolver:ce(be),defaultValues:{name:"",description:"",triggerType:"job_created",conditions:[],actions:[],isActive:!0}}),y=E({mutationFn:s=>z("POST","/api/workflows/rules",s),onSuccess:()=>{f({title:"Rule Created",description:"Workflow rule has been created successfully"}),v(!1),d.reset(),C.invalidateQueries({queryKey:["/api/workflows/rules"]})},onError:()=>{f({title:"Error",description:"Failed to create workflow rule",variant:"destructive"})}}),k=E({mutationFn:({ruleId:s,data:a})=>z("POST",`/api/workflows/trigger/${s}`,a),onSuccess:()=>{f({title:"Rule Triggered",description:"Workflow rule has been executed manually"}),C.invalidateQueries({queryKey:["/api/workflows/executions"]})}}),O=s=>{y.mutate(s)};return W?e.jsx("div",{className:"flex items-center justify-center h-screen","data-testid":"loading-workflow-automation",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6","data-testid":"workflow-automation-page",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white","data-testid":"title-workflow-automation",children:"Workflow Automation"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400","data-testid":"text-workflow-description",children:"Automate business processes with custom rules and triggers"})]}),e.jsxs(ee,{open:L,onOpenChange:v,children:[e.jsx(se,{asChild:!0,children:e.jsxs(l,{"data-testid":"button-create-rule",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Create Rule"]})}),e.jsxs(te,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(ie,{children:"Create Workflow Rule"}),e.jsx(re,{children:"Define automated business processes and triggers"})]}),e.jsx(de,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(O),className:"space-y-4",children:[e.jsx(u,{control:d.control,name:"name",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Rule Name"}),e.jsx(g,{children:e.jsx(J,{placeholder:"Enter rule name",...s,"data-testid":"input-rule-name"})}),e.jsx(w,{})]})}),e.jsx(u,{control:d.control,name:"description",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Description"}),e.jsx(g,{children:e.jsx(oe,{placeholder:"Describe what this rule does",...s,"data-testid":"textarea-rule-description"})}),e.jsx(w,{})]})}),e.jsx(u,{control:d.control,name:"triggerType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Trigger Event"}),e.jsxs(xe,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(g,{children:e.jsx(me,{"data-testid":"select-trigger-type",children:e.jsx(he,{placeholder:"Select trigger event"})})}),e.jsxs(ue,{children:[e.jsx(m,{value:"job_created",children:"Job Created"}),e.jsx(m,{value:"shift_completed",children:"Shift Completed"}),e.jsx(m,{value:"payment_processed",children:"Payment Processed"}),e.jsx(m,{value:"user_registered",children:"User Registered"}),e.jsx(m,{value:"schedule_time",children:"Scheduled Time"})]})]}),e.jsx(w,{})]})}),e.jsx(u,{control:d.control,name:"isActive",render:({field:s})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(p,{className:"text-base",children:"Active"}),e.jsx(ne,{children:"Enable this rule to run automatically"})]}),e.jsx(g,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange,"data-testid":"switch-rule-active"})})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:y.isPending,"data-testid":"button-save-rule",children:y.isPending?"Creating...":"Create Rule"})]})]})})]})]})]}),e.jsxs(U,{defaultValue:"rules",className:"w-full",children:[e.jsxs(H,{children:[e.jsx(N,{value:"rules","data-testid":"tab-rules",children:"Rules"}),e.jsx(N,{value:"executions","data-testid":"tab-executions",children:"Executions"}),e.jsx(N,{value:"templates","data-testid":"tab-templates",children:"Templates"})]}),e.jsx(b,{value:"rules",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:M.map(s=>e.jsxs(i,{"data-testid":`card-rule-${s.id}`,children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),s.name,e.jsx(h,{variant:s.isActive?"default":"secondary","data-testid":`badge-rule-status-${s.id}`,children:s.isActive?"Active":"Inactive"})]}),e.jsx(x,{children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k.mutate({ruleId:s.id,data:{}}),disabled:k.isPending,"data-testid":`button-trigger-rule-${s.id}`,children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"outline","data-testid":`button-edit-rule-${s.id}`,children:e.jsx(ge,{className:"w-4 h-4"})})]})]})}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Trigger:"}),e.jsx(h,{variant:"outline",className:"ml-2","data-testid":`badge-trigger-${s.id}`,children:s.trigger.type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Actions: "}),s.actions.map((a,q)=>e.jsxs(h,{variant:"secondary",className:"ml-1","data-testid":`badge-action-${s.id}-${q}`,children:[a.type==="send_notification"&&e.jsx(I,{className:"w-3 h-3 mr-1"}),a.type==="send_email"&&e.jsx(X,{className:"w-3 h-3 mr-1"}),a.type==="webhook_call"&&e.jsx(Ne,{className:"w-3 h-3 mr-1"}),a.type.replace("_"," ")]},q))]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{"data-testid":`text-executions-${s.id}`,children:["Executed ",s.executionCount," times"]}),s.lastExecuted&&e.jsxs("span",{"data-testid":`text-last-executed-${s.id}`,children:["Last: ",new Date(s.lastExecuted).toLocaleString()]})]})]})})]},s.id))})}),e.jsxs(b,{value:"executions",className:"space-y-4",children:[n.stats&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(i,{"data-testid":"card-execution-stats",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-total-executions",children:((T=n.stats)==null?void 0:T.total)??0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Executions"})]})})}),e.jsx(i,{"data-testid":"card-success-rate",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600","data-testid":"text-success-rate",children:[((_=(S=n.stats)==null?void 0:S.successRate)==null?void 0:_.toFixed(1))??0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Success Rate"})]})})}),e.jsx(i,{"data-testid":"card-avg-duration",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold","data-testid":"text-avg-duration",children:[((D=(A=n.stats)==null?void 0:A.averageDuration)==null?void 0:D.toFixed(0))??0,"ms"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg Duration"})]})})}),e.jsx(i,{"data-testid":"card-failed-count",children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600","data-testid":"text-failed-count",children:((R=n.stats)==null?void 0:R.failed)??0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Failed"})]})})})]}),e.jsxs(i,{"data-testid":"card-recent-executions",children:[e.jsxs(c,{children:[e.jsx(o,{children:"Recent Executions"}),e.jsx(x,{children:"Latest workflow automation executions"})]}),e.jsx(r,{children:e.jsx("div",{className:"space-y-3",children:(F=n.executions)==null?void 0:F.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg","data-testid":`execution-${a}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.result==="success"?e.jsx(ve,{className:"w-5 h-5 text-green-600"}):s.result==="partial"?e.jsx(G,{className:"w-5 h-5 text-orange-600"}):e.jsx(fe,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium","data-testid":`text-execution-rule-${a}`,children:s.ruleId}),e.jsx("div",{className:"text-sm text-gray-600","data-testid":`text-execution-timestamp-${a}`,children:new Date(s.timestamp).toLocaleString()})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(h,{variant:s.result==="success"?"default":s.result==="partial"?"secondary":"destructive","data-testid":`badge-execution-result-${a}`,children:s.result}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[s.duration,"ms â€¢ ",s.executedActions.length," actions"]})]})]},s.id))})})]})]}),e.jsx(b,{value:"templates",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(i,{"data-testid":"card-template-job-assignment",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),"Auto Job Assignment"]}),e.jsx(x,{children:"Automatically assign qualified workers to new job postings"})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Trigger:"})," Job Created"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Actions:"})," Find best match worker, assign job, send notifications"]}),e.jsx(l,{size:"sm",variant:"outline","data-testid":"button-use-job-template",children:"Use Template"})]})})]}),e.jsxs(i,{"data-testid":"card-template-payment-reminder",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-green-600"}),"Payment Reminders"]}),e.jsx(x,{children:"Send automatic payment reminders for overdue invoices"})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Trigger:"})," Scheduled (Weekly)"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Actions:"})," Check overdue payments, send email reminders"]}),e.jsx(l,{size:"sm",variant:"outline","data-testid":"button-use-payment-template",children:"Use Template"})]})})]}),e.jsxs(i,{"data-testid":"card-template-timesheet-reminder",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-orange-600"}),"Timesheet Reminders"]}),e.jsx(x,{children:"Remind workers to submit timesheets at end of week"})]}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Trigger:"})," Scheduled (Friday 5 PM)"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Actions:"})," Check incomplete timesheets, send reminders"]}),e.jsx(l,{size:"sm",variant:"outline","data-testid":"button-use-timesheet-template",children:"Use Template"})]})})]})]})})]})]})}export{Le as default};
